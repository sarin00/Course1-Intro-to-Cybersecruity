## 1. Що таке Web Application Vulnerability (вразливість у веб застосунку)?

Веб застосунки - це програми, які зазвичай доступні всьому інтенету і які працюють з HTTP. Як і будь-яка програма, веб застосунок може містити у собі вразливості. 
`Вразливість` - це недолік системи, який знижує безпеку системи і може бути використан в зловмисних цілях. Відповідно, якщо цей недолік знайдено у веб застосунку - це і є web application vulnerability.

Результатом експлуатації вразливості (використання вразливості у зловмисних цілях) можуть бути отримання несанкціонованого доступу до системи, акаунтів користувачів, отримання чутливої інформації, пошкодження або зміни даних, тощо. Ці вразливості можуть виникати через неправильне проектування, програмування або налаштування веб застосунків, використання вразливих чи застарілих компонентів, тощо.

## 2. OWASP top 10
Веб вразливості дуже різні, і для ознайомлення з ними ми вивчимо OWASP top 10. OWASP - це відкритий некомерційний проект з безпеки застосунків. OWASP періодично аналізує статистику по найпоширеніших вразливостях що знаходились та використовувались останнім часом, і поєднують результати топ 10 типів вразливостей у список під назвою [OWASP top 10](https://owasp.org/www-project-top-ten/).

Це не означає що інших типів вразливостей не існує, просто ці 10 є найпоширенішими. Коли ми займаємось безпекою наших веб застосунків, ми спираємось на OWASP top 10 у проектуванні, тестуванні, та моніторингу застосунків. Ознайомитись на практиці з різними вразливостями та методами їх попередження можна на та сайті [hacksplaining.com](https://hacksplaining.com/owasp)

Остання версія списку OWASP top 10 була опублікована у 2021 році на момент написання, і містить у собі такі типи вразливостей:
```
1. Broken Access Control
2. Cryptographic Failures
3. Injection
4. Insecure Design
5. Security Misconfiguration
6. Vulnerable and Outdated Components
7. Identification and Authentication Failures
8. Software and Data Integrity Failures
9. Security Logging and Monitoring Failures
10. Server-Side Request Forgery
```

`1. Broken Access Control`  
Виникає коли системі невдається належним чином обмежити доступ користувачів до певних функцій або даних.  
Приклад: Неправильно налаштовані права доступу, що дозволяють звичайним користувачам отримати доступ до адміністративних функцій. Прямі посилання на захищені сторінки, якими користувачі можуть скористатися без авторизації.  
[Практичний приклад](https://hacksplaining.com/lessons/broken-access-control/start)

`2. Cryptographic Failures`  
Виникає коли криптографічні функції або методи не реалізовані або налаштовані належним чином, що призводить до витоку чутливої інформації.  
Приклад: Використання слабкого шифрування, яке легко піддається взлому. Зберігання конфіденційних даних у відкритому вигляді.  
[Практичний приклад](https://hacksplaining.com/lessons/unencrypted-communication/start)

`3. Injection`  
Виникає коли неналежним чином обробляються дані які вводить користувач, що може призвести до виконання навмисно шкідливого коду. Раніше цей тип вразливостей був розділений на SQL injections, XSS, Command execution, але зараз все це є однією групою.  
Приклади:  
SQL Injection: ін'єкція SQL-коду через user input, що дозволяє зловмиснику виконувати свої команди для бази даних.  
[Практичний приклад](https://hacksplaining.com/lessons/sql-injection/start)  
Command Execution: ін'єкція команди через user input, що дозволяє зловмиснику виконувати команди на самій операційній системі на якій розміщено веб застосунок.  
[Практичний приклад](https://hacksplaining.com/lessons/command-execution/start)  

`4. Insecure Design`  
Ці вразливості пов'язані з неправильним проектуванням системи, відсутності "моделювання загроз" на етапі проектування. Такі проблеми повʼязані не з помилками в коді, а з непропрацьованою логікою роботи самого застосунку.  
Приклад: при створенні якогось функціоналу розробники не пропрацювали використання цього функціоналу "не за призначенням", або "не так як розробники хотіли". Insecure design призводить до появи інших типів вразливостей у застосунку.  
[Більше інформації](https://hacksplaining.com/lessons/insecure-design/start)

`5. Security Misconfiguration`  
Виникає коли неправильно або недостатньо налаштовуються конфігурації різних компонентів систем, повʼязані з безпекою.  
Приклад: Дефолтні юзернейм та паролі до систем не були змінені. Відкриті зайві порти, сервіси, функціонал, тощо.  
[Практичний приклад](https://hacksplaining.com/lessons/lax-security-settings/start)  

`6. Vulnerable and Outdated Components`  
Ця вразливість виникає коли ваша система використовує вразливі компоненти, розроблені кимось іншим.  
Приклад: Ваш застосунок на node.js використовує бібліотеки з вразливостями. Використання системи яку перестав підтримувати та оновлювати її вендор.  
[Практичний приклад](https://hacksplaining.com/lessons/toxic-dependencies/start)

`7. Identification and Authentication Failures`  
Ця вразливість виникає, коли механізми ідентифікації та аутентифікації не працюють або недостатньо ефективні.  
Приклади: Прості або слабкі паролі, які легко вгадати або підібрати методами перебору. Відсутність механізмів двофакторної аутентифікації.  
[Практичний приклад](https://hacksplaining.com/lessons/weak-session/start)  

`8. Software and Data Integrity Failures`  
Ця вразливість виникає коли наша система використовує компоненти, походження та цілісність яких не перевіряється.  
Приклад: SolarWinds hack.  

`9. Security Logging and Monitoring Failures`  
Ця вразливість сама по собі не дає хакерам можливості компрометувати нашу систему, але відсутність логування і моніторингу означає що коли кібератака станеться - ми її не задетектуємо і не побачимо одразу.  
[Більше інформації](https://hacksplaining.com/lessons/logging-and-monitoring/start)  

`10. Server-Side Request Forgery`  
Ця вразливість виникає тоді, коли веб застосунок звертається до зовнішніх ресурсів які надає або може змінювати клієнт. В результаті клієнт робить запити до зовнішніх ресурсів від імені веб сервера.  
[Практичний приклад](https://hacksplaining.com/lessons/ssrf/start)  

## 3. CVE та CVSS
Ми поговорили з вами про загальні типи вразливостей у веб застосунках, але як нам посилатися на конкретну вразливість у конкретному продукті? Для цього і потрібно CVE.  
`CVE (Common Vulnerabilities and Exposures)` - це база даних, яка включає ідентифікатори (CVE-номери) вразливостей. Кожен CVE-номер є унікальним ідентифікатором для конкретної вразливості у конкретному продукті. CVE-номери використовуються для стандартизованого виявлення і відстеження вразливостей. Кожна вразливість може мати свій CVE-номер, який дозволяє спеціалістам по безпеці швидше зрозуміти, про яку саме проблему йдеться та як з нею боротися.  
[Сайт MITRE зі списком CVE](https://cve.mitre.org/cve/)  

Коли інженери знаходять якусь вразливість, їм дуже важливо оцінити її вплив, її критичність для безпеки системи. Чим більше шкоди ця вразливість може нанести системі - тим більший буде CVSS score.  
`CVSS` є одним із кількох способів вимірювання впливу вразливостей на безпеку системи. CVSS — це відкритий набір стандартів, який використовується для оцінки вразливості та призначення рівня шкоди за шкалою від 0 до 10.  

## 4. Завдання - OWASP juice shop
Для того щоб краще попрактикуватись у веб вразливостях ми використаємо веб застосунок OWASP juiceshop. Це намірено вразливий застосунок, який дозволяє нам відточити навички пошуку та експлойтування вразливостей. Якщо ви проходите це заняття під час воркшопу, я надам вам доступ до juiceshop. Якщо ви виконуєте це завдання самостійно, ви можете запустити juiceshop на своєму компʼютері і виконати ці завдання локально. [Інструкції для самостійного встановлення juiceshop](https://pwning.owasp-juice.shop/companion-guide/latest/part1/running.html).  

Juiceshop має десятки завдань, ми виконаємо з вами 3, а інші завдання залишаються вам як домашня робота.  
### 1. Zero Stars (User Input Validation Failure)  
Задача цього завдання - відправити відгук з нулем зірок. Якщо робити відгук через веб форму, мінімальна кількість зірок які можна поставити це 1. 
Хід роботи:
1. Встановити Burp Suite та Firefox браузер.  
2. [Додати Burp Suite як proxy в браузері Firefox](https://portswigger.net/burp/documentation/desktop/external-browser-config/browser-config-firefox)
3. Відкрити браузер Firefox, зайти на сторінку juice shop під назвою Customer Feedback  
4. В налаштуваннях Burp Suite зайти в Intercept, впевнитись що перехват запитів включено (Intercept is on)
5. Заповнити форму звʼязку і натиснути кнопку "Submit"  
6. Відкрити Burp Suite -> Intercept, і подивитись деталі перехваченого HTTP запиту який має відправитись веб застосунку  
7. В деталях HTTP запиту знайти де вказується інформація про рейтинг відгуку, і змінити рейтинг на 0
8. Натиснути кнопку "Forward", щоб наш змінений HTTP запит відправився веб застосунку
9. Ми успішно передали дані які, теоретично, не мали б змоги передавати  

### 2. Error Handling (Security Misconfiguration)
Задача цього завдання - відправити веб застосунку завідомо неправильний запит який змусить juice shop показати помилку з інформацією про веб застосунок, яку користувачі не мали б бачити.  
Хід роботи:  
1. Відкрити браузер Firefox, зайти на основну сторінку juice shop зі списком продуктів
2. В налаштуваннях Burp Suite зайти в Intercept, впевнитись що перехват запитів включено (Intercept is on)
3. Клікнути на будь-який з продуктів
4. Зайти в Burp Suite, подивитись на деталі перехваченого HTTP запиту. Ми бачимо, що запит йде на endpoint з url /rest/products/...
5. Ми змінемо адресу API endpoint на таку, якої не існує і подивимось, як саме веб застосунок обробить це. Змініть URL в запиті з /rest/products/... на /rest/blablabla. Натисніть кнопку "Forward" або "Send"  
6. Подивитись на деталі помилки яку повертає веб застосунок  

### 3. Login Admin (Injection)
Задача цього завдання - зробити SQL інʼєкцію на сторінці логіну щоб, не маючи доступу до адміністративного облікового запису, залогінитись на сайт як адміністратор.  
Хід роботи:  
1. Відкрити браузер Firefox, зайти на сторінку Account -> Login в juice shop  
2. В налаштуваннях Burp Suite зайти в Intercept, впевнитись що перехват запитів включено (Intercept is on)  
3. Ввести буль-який логін та будь-який пароль, та натиснути кнопку "Log in"
4. Відкрити Burp Suite Intercept, подивитись деталі HTTP запиту до /rest/user/login
5. Всередині запиту ми бачимо параметри email та password, коли після ":" передаються введені нами дані. Використовуючи знання з SQL інʼєкцій та синтаксису SQL, змінити введену нами інформацію в полі email.
6. Приклад нового значення поля email: `admin' or 1=1 --`
7. Натиснути "Forward" або "Send" щоб відправити змінений HTTP запит веб застосунку
8. Через змінений запит до бази даних, система залогінює нас як першого користувача у списку (першого створиного користувача у системі), в якого за щасливим збігом обставин є адміністративні привілеї.

## 5. Висновки
1. Встановлювати WAF (Web Application Firewall) для захисту своїх веб застосунків. WAF має бути правильно налаштованим і працювати. Після імплементації WAF спробуйте самостійно атакувати свій застосунок щоб перевірити ефективність WAF.
2. Завжди валідувати User Input, і завжди робити це як мінімум на бекенді, бо запити можна відправляти не тільки з наших мобільних застосунків чи браузерів.
3. Писати код так щоб Інʼєкції були неможливими. Рекомендації для конкретних мов програмування можна побачити на сайті [hacksplaining.com](https://hacksplaining.com/)  
4. Завжди використовувати HTTPS для шифрування передачі даних між клієнтом та вашим веб сервером. Є платні та безкоштовні SSL сертифікати, детальніше про них ми вивчали на минулому занятті.
5. Контролювати та фільтрувати інформацію яку бачать клієнти в деталях помилок.  
6. При встановленні будь-яких інструментів та застосунків ЗАВЖДИ змінюйте дефолтні логін та пароль (логіни та паролі створені за замовчуванням). Якщо ви знаєте цей дефолтний пароль - його знає весь інтернет.  
7. Різні програми та застосунки часто мають документацію та свої best practices - інструкції по налаштуванню цієї програми безпечним чином. Читайте та слідуйте цим best practices - ніхто не знатиме рекомендації по безпеці краще за виробника цього продукта.  
8. Налаштовуйте логування ваших ресурсів та моніторте логи. Створіть сповіщення для логів які вас цікавлять більше всього. Є оупенсорсні системи для зберігання логів та створення альортів (наприклад, Grafana/Loki, ELK stack).  
9. Піклуйтесь про захист від DDoS атак. З обмеженими ресурсами захист теж буде обмеженим, але краще невеликий захист ніж ніякий. WAF використовують в тому числі і проти DDoS атак, але WAF треба правильно налаштовувати у відповідності з вашим веб застосунком і його функціоналом.  
10. Сканувати свої програми, бібліотеки, ОС, та інші компоненти системи на вразливості, і вчасно оновлювати та пропатчувати їх.  

## 6. Домашнє завдання
1. Пройти всі завдання на сайті [hacksplaining.com](https://hacksplaining.com/owasp)
2. Пройти всі завдання в Juice Shop. Якщо це ваші перщі кроки у пентесті веб застосунків, не цурайтесь читати та дивитись відео з детальними проходженнями та поясненнями цих завдань. До того як ви зможете самостійно знаходити та експлойтувати вразливості, вам потрібно спочатку побачити і зрозуміти як це має працювати  
3. Для більшої інформації по OWASP top 10 подивитись на сайт OWASP з [cheatsheet](https://cheatsheetseries.owasp.org/IndexTopTen.html)  
