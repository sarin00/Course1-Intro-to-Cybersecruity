## 1. Що таке VPN?
VPN, або Virtual Private Network - це “віртуальна приватна мережа”, яка по-суті є захищеною і зашифрованою комунікацією між 2-ма пристроями. Ця комунікація дає пристроям віддалений доступ до мереж, які без VPN були б недоступні.

Приклад, знайомий всім: в нас є сайт, доступ до якого можна отримати тільки з “дозволеної” країни. Щоб на цей сайт зайти ви включаєте на телефоні VPN, і сайт стає доступним. Що коїться під капотом:
Ваш телефон створює VPN тунель з VPN сервером (наприклад з сервером ProtonVPN у Німеччині).
Всі наступні мережеві запити які робить ваш телефон йдуть спочатку до VPN сервера, а вже потім від імені VPN сервера вони йдуть на обмежений веб-сайт. Сайт бачить ваші запити як запити від Німецького VPN-серверу.
Невзіраючи на цей простий приклад, VPN потрібен у багатьох інших складних ситуаціях вдома та у бізнесі, і ці ситуації ми розглянемо далі. 

## 2. Типи VPN
Зазвичай у бізнесі VPN використовується не для обходу заборон, а для забезпечення передачі даних через незахищені мережі (інтернет). Загально такі ситуації діляться на 2 типи VPN-підключень: `Site-to-site` та `Remote Access`.

`Site-to-site` - це постійний VPN тунель між 2-ма пристроями, який поєднує 2 чи більше віддалені мережі і дає можливість цим мережам та їх пристроям комунікувати між собою. Приклад: у вашої компанії є 2 офіси, ви хочете щоб робітники з офісу A мали доступ до серверів/ресурсів офісу Б. Якщо між роутерами (або частіше NGFW) налаштований VPN тунель, - то робітники з офісу А зможуть запросто бачити всі ресурси з офісу Б наче вони самі фізично знаходяться в офісі Б. В такій схемі роботи зазвичай використовуються peer-to-peer тунель, в якому кожен peer є рівноправним і однаково автентифіковує інших peer (роутер офісу А автентифіковує роутер офісу Б, і навпаки). 

`Remote access` - це VPN тунель, що потрібен для віддаленого доступу комп’ютера до мережі з ресурсами, які приховані від нього. Приклад: Ваші сервери знаходяться в офісі у приватній мережі, але деякі з ваших розробників працюють з дому, і їм потрібен віддалений доступ до цієї мережі. Встановлення VPN серверу дає можливість розробникам підключатись через інтернет по зашифрованому безпечному тунелю (VPN) до VPN сервера, а через нього до прихованих ресурсів, таким чином захищаючи як ресурси так і інформацію що передається по VPN. Результат - сервери недоступні з інтернету, а розробники можуть продовжувати роботу віддалено. В такій схемі роботи зазвичай використовується VPN сервер, до якого підключається багато VPN клієнтів яких він автентифіковує (наприклад, коли розробник ініціює VPN тунель до сервера - сервер просить його ввести логін, пароль, та 2FA).

## 3. Теоретична задача
Розглянемо ситуацію, в якій ваші робітники хочуть отримати доступ до ваших внутрішніх мереж з серверами. У вашої інфраструктури 3 сабнети - DMZ з веб-серверами, Application мережа з серверами вашої програми, та Database мережа де знаходяться бази з даними. Це 3 окремі мережі, які також мають різну цінність. Уявімо що у вас є звичайні розробники, їм потрібен доступ тільки до DMZ та Application сабнетів, і у вас є головний інженер, якому потрібен доступ до всіх 3-х сабнетів.
Питання:
1. Який тип VPN архітектури ви б обрали, чому?
2. Як саме розмежувати привілеї, дозволивши головному інженеру доступ всюди, але обмеживши доступ звичайних розробників?
3. Який пристрій найкраще підійшов би для цієї задачі?

## 4. Практичне завдання - встановлення та налаштування OpenVPN серверу
Налаштувати OpenVPN сервер та підключення через нього до іншого внутрішнього сабнету.
У VPN сервера є 2 інтерфейси - один стандартний, з виходом в інтернет і в одній мережі з клієнтським комп’ютером, а другий у приватній мережі. В цій приватній мережі також є сервер, доступ до якого і треба отримувати через VPN.

![vpn](https://github.com/sarin00/Course1-Intro-to-Cybersecruity/blob/main/%D1%8F%D0%94%D0%BE%D0%B4%D0%B0%D1%82%D0%BA%D0%BE%D0%B2%D1%96%20%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D1%96%D0%B0%D0%BB%D0%B8/vpn.png)

1. Оновити убунту
```
apt update
apt upgrade
```
2. Встановити OpenVPN AS (access server) з [репозиторія](https://as-portal.openvpn.com/get-access-server/ubuntu)
```
apt update && apt -y install ca-certificates wget net-tools gnupg

wget https://as-repository.openvpn.net/as-repo-public.asc -qO /etc/apt/trusted.gpg.d/as-repository.asc

echo "deb [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/as-repository.asc] http://as-repository.openvpn.net/as/debian jammy main">/etc/apt/sources.list.d/openvpn-as-repo.list

apt update && apt -y install openvpn-as
```
3. Під час інсталяції створюється користувач openvpn, та випадковий пароль для нього (якщо пропустили - пароль можна подивитись в /usr/local/openvpn_as/init.log
4. Зайти на https://localhost:943/admin, та залогінитись з новоствореним openvpn користувачем, при бажанні змінити пароль
5. Додати VPN серверу ще один інтерфейс який буде частиною внутрішньго сабнету
6. Налаштувати IP адреси які отримуватимуть користувачі та в які мережі вони матимуть доступ. Configuration => VPN Settings
7. Створити нового користувача, який буде VPN клієнтом. User Management => User Permissions, створити пароль користувачу
8. Зайти на сайт нашого OpenVPN сервера під новим користувачем, скачати інсталятор на OpenVPN клієнт або скачати конфіг
9. На внутрішньому сервері встановити nginx (apt install nginx)
10. Спробувати зайти на веб сторінку внутрішнього сервера з VPN тунелем тестового користувача. Виключити VPN тунель, повторити спробу

## 5. Домашнє завдання: Wireguard та peer-to-peer
1. Налаштувати Wiregiard на ubuntu сервері, створити VPN тунель між вашим комп’ютером та сервером з wireguard, отримати доступ до внутрішніх ресурсів по аналогії з минулим завданням. 
2. [Tryhackme OpenVPN](https://tryhackme.com/room/openvpn)

## 6. Додаткові матеріали
1. [OpenVPN інсталяція на Ubuntu](https://as-portal.openvpn.com/get-access-server/ubuntu)
2. [Wireguard офіційний сайт](https://www.wireguard.com/)  

